<div class="detail-container">
  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Loading standings...</p>
    </div>
  }

  <!-- Error State -->
  @if (error() && !isLoading()) {
    <div class="error-container">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
        <path d="M12 8v4M12 16h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <p>{{ error() }}</p>
      <div class="error-actions">
        <button class="retry-btn" (click)="competitionId() && loadStandings(competitionId()!)">Try Again</button>
        <button class="back-btn" (click)="goBack()">Go Back</button>
      </div>
    </div>
  }

  <!-- Content -->
  @if ((standingsData() || matchesData()) && !isLoading() && !error()) {
    <div class="detail-content">
      <!-- Header -->
      <header class="detail-header">
        <button class="back-button" (click)="goBack()" aria-label="Go back to competitions">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Back to Competitions</span>
        </button>
        
        @if (getCompetitionInfo()) {
          <div class="competition-info">
            @if (getCompetitionInfo()!.emblem) {
              <img 
                [src]="getCompetitionInfo()!.emblem" 
                [alt]="getCompetitionInfo()!.name"
                class="competition-emblem"
                (error)="$event.target.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ccircle cx=%2250%22 cy=%2250%22 r=%2245%22 fill=%22%23e0e0e0%22/%3E%3Cpath d=%22M50 20 L60 45 L85 45 L68 63 L75 90 L50 75 L25 90 L32 63 L15 45 L40 45 Z%22 fill=%22%23999%22/%3E%3C/svg%3E'"
              />
            }
            <div class="competition-details">
              <h1 class="competition-name">{{ getCompetitionInfo()!.name }}</h1>
              <div class="competition-meta">
                @if (getCompetitionInfo()!.area.flag) {
                  <img [src]="getCompetitionInfo()!.area.flag" [alt]="getCompetitionInfo()!.area.name" class="country-flag" />
                }
                <span class="country-name">{{ getCompetitionInfo()!.area.name }}</span>
                <span class="season-info">
                  Season {{ getSeasonYear(getCompetitionInfo()!.season.startDate) }}
                </span>
              </div>
            </div>
          </div>

          <div class="season-dates">
            <div class="date-item">
              <span class="date-label">Start Date</span>
              <span class="date-value">{{ formatDate(getCompetitionInfo()!.season.startDate) }}</span>
            </div>
            <div class="date-item">
              <span class="date-label">End Date</span>
              <span class="date-value">{{ formatDate(getCompetitionInfo()!.season.endDate) }}</span>
            </div>
            @if (getCompetitionInfo()!.season.currentMatchday !== null) {
              <div class="date-item">
                <span class="date-label">Current Matchday</span>
                <span class="date-value">{{ getCompetitionInfo()!.season.currentMatchday }}</span>
              </div>
            }
          </div>
        }
      </header>

      <!-- Tabs -->
      <div class="tabs-container">
        <button 
          class="tab-button" 
          [class.active]="activeTab() === 'standings'"
          (click)="setActiveTab('standings')"
        >
          Standings
        </button>
        <button 
          class="tab-button" 
          [class.active]="activeTab() === 'matches'"
          (click)="setActiveTab('matches')"
        >
          Matches
        </button>
      </div>

      <!-- Standings Tab Content -->
      @if (activeTab() === 'standings') {
        @if (standingsData()) {
          <div class="standings-table-container">
            <div class="table-header">
              <h2>League Standings</h2>
              <div class="legend">
                <div class="legend-item">
                  <span class="legend-color champions-league"></span>
                  <span>Champions League</span>
                </div>
                <div class="legend-item">
                  <span class="legend-color europa-league"></span>
                  <span>Europa League</span>
                </div>
                <div class="legend-item">
                  <span class="legend-color relegation"></span>
                  <span>Relegation</span>
                </div>
              </div>
            </div>

            <div class="table-wrapper">
              <table class="standings-table">
                <thead>
                  <tr>
                    <th class="position-col">Pos</th>
                    <th class="team-col">Team</th>
                    <th class="stat-col">P</th>
                    <th class="stat-col">W</th>
                    <th class="stat-col">D</th>
                    <th class="stat-col">L</th>
                    <th class="stat-col">GF</th>
                    <th class="stat-col">GA</th>
                    <th class="stat-col">GD</th>
                    <th class="points-col">Pts</th>
                  </tr>
                </thead>
                <tbody>
                  @for (team of standingsTable; track team.position) {
                    <tr [class]="getPositionClass(team.position)" (click)="viewTeam(team.team.id)" class="clickable-row">
                      <td class="position-cell">
                        <span class="position-number">{{ team.position }}</span>
                      </td>
                      <td class="team-cell">
                        <div class="team-info">
                          <img 
                            [src]="team.team.crest" 
                            [alt]="team.team.name"
                            class="team-crest"
                            (error)="$event.target.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ccircle cx=%2250%22 cy=%2250%22 r=%2245%22 fill=%22%23e0e0e0%22/%3E%3C/svg%3E'"
                          />
                          <div class="team-details">
                            <span class="team-name">{{ team.team.shortName || team.team.name }}</span>
                            <span class="team-tla">{{ team.team.tla }}</span>
                          </div>
                        </div>
                      </td>
                      <td class="stat-cell">{{ team.playedGames }}</td>
                      <td class="stat-cell">{{ team.won }}</td>
                      <td class="stat-cell">{{ team.draw }}</td>
                      <td class="stat-cell">{{ team.lost }}</td>
                      <td class="stat-cell">{{ team.goalsFor }}</td>
                      <td class="stat-cell">{{ team.goalsAgainst }}</td>
                      <td class="stat-cell" [class.positive]="team.goalDifference > 0" [class.negative]="team.goalDifference < 0">
                        {{ team.goalDifference > 0 ? '+' : '' }}{{ team.goalDifference }}
                      </td>
                      <td class="points-cell">
                        <strong>{{ team.points }}</strong>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>
        } @else {
          <div class="loading-container">
            <div class="spinner"></div>
            <p>Loading standings...</p>
          </div>
        }
      }

      <!-- Matches Tab Content -->
      @if (activeTab() === 'matches') {
        <div class="matches-container">
          <!-- Matchday Selector -->
          @if (availableMatchdays().length > 0) {
            <div class="matchday-selector">
              <div class="matchday-band">
                @for (matchday of availableMatchdays(); track matchday) {
                  <button
                    class="matchday-button"
                    [class.active]="selectedMatchday() === matchday"
                    (click)="selectMatchday(matchday)"
                  >
                    {{ matchday }}
                  </button>
                }
              </div>
            </div>
          }

          <!-- Loading Matches -->
          @if (isLoadingMatches()) {
            <div class="loading-matches">
              <div class="spinner"></div>
              <p>Loading matches...</p>
            </div>
          }

          <!-- Matches List -->
          @if (!isLoadingMatches() && filteredMatches().length > 0) {
            <div class="matches-list">
              @for (match of filteredMatches(); track match.id) {
                <div class="match-card" [class]="getMatchStatusClass(match.status)">
                  <div class="match-date-time">
                    <span class="match-date">{{ formatDate(match.utcDate) }}</span>
                    <span class="match-time">{{ formatTime(match.utcDate) }}</span>
                  </div>
                  
                  <div class="match-content">
                    <div class="team-section home-team">
                      <img 
                        [src]="match.homeTeam.crest" 
                        [alt]="match.homeTeam.name"
                        class="team-crest-small"
                        (error)="$event.target.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ccircle cx=%2250%22 cy=%2250%22 r=%2245%22 fill=%22%23e0e0e0%22/%3E%3C/svg%3E'"
                      />
                      <span class="team-name">{{ match.homeTeam.shortName || match.homeTeam.name }}</span>
                    </div>

                    <div class="match-score">
                      @if (match.score.fullTime.home !== null && match.score.fullTime.away !== null) {
                        <div class="score-display">
                          <span class="score-number">{{ match.score.fullTime.home }}</span>
                          <span class="score-separator">-</span>
                          <span class="score-number">{{ match.score.fullTime.away }}</span>
                        </div>
                      } @else {
                        <div class="score-display">
                          <span class="vs-text">VS</span>
                        </div>
                      }
                      <span class="match-status" [class]="getMatchStatusClass(match.status)">
                        {{ match.status.replace('_', ' ') }}
                      </span>
                    </div>

                    <div class="team-section away-team">
                      <img 
                        [src]="match.awayTeam.crest" 
                        [alt]="match.awayTeam.name"
                        class="team-crest-small"
                        (error)="$event.target.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ccircle cx=%2250%22 cy=%2250%22 r=%2245%22 fill=%22%23e0e0e0%22/%3E%3C/svg%3E'"
                      />
                      <span class="team-name">{{ match.awayTeam.shortName || match.awayTeam.name }}</span>
                    </div>
                  </div>
                </div>
              }
            </div>
          }

          <!-- No Matches -->
          @if (!isLoadingMatches() && filteredMatches().length === 0) {
            <div class="no-matches">
              <p>No matches found for the selected matchday.</p>
            </div>
          }
        </div>
      }
    </div>
  }
</div>
